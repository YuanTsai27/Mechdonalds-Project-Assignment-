
#include "launcher.h"

#include <iostream>
#include <vector>

#include "message.h"
#include "utils.h"

using namespace std;

string Launcher::COMMAND_PREFIX = "mechdonalds> ";

Launcher::Launcher() {}

bool Launcher::ProcessCommand(const std::string &cmd_input) {
  // Check it is a valid command name
  string cmd_input_name = Utils::GetFirstWord(cmd_input);
  Command command = Command::Find(cmd_input_name);
  if (command == Command::INVALID) {
    Message::COMMAND_NOT_FOUND.PrintMessage({cmd_input_name});
    return true;
  }

  // Check the number of arguments provided match as the command expects
  vector<string> args = Utils::SplitString(cmd_input);
  int num_args_provided = args.size() - 1;
  int num_args_expected = command.GetNumArgs();
  if (num_args_provided != num_args_expected) {
    string provided = to_string(num_args_provided) + " argument" +
                      (num_args_provided == 1 ? "" : "s");
    string expected = to_string(num_args_expected) + " argument" +
                      (num_args_expected == 1 ? "" : "s");
    cout << Message::WRONG_ARGUMENT_COUNT.GetMessage({command.GetName()}) +
                " Expected " + expected + ", but " + provided + " provided."
         << endl;
    return true;
  }

  if (command == Command::NEW_ACCOUNT) {
    app_.CreateNewAccount(args[1], args[2]);
  } else if (command == Command::TOP_UP_CREDIT) {
    app_.TopUpAccount(args[1], args[2]);
  } else if (command == Command::PRINT_ACCOUNTS) {
    app_.PrintAccounts();
  } else if (command == Command::NEW_ORDER) {
    app_.StartNewOrder(args[1]);
  } else if (command == Command::CANCEL_ORDER) {
    app_.CancelCurrentOrder();
  } else if (command == Command::SUBMIT_ORDER) {
    app_.SubmitCurrentOrder();
  } else if (command == Command::ADD_BURGER) {
    app_.AddBurgerToCurrentOrder(args[1], args[2]);
  } else if (command == Command::ADD_DRINK) {
    app_.AddDrinkToCurrentOrder(args[1]);
  } else if (command == Command::ADD_COMBO) {
    app_.AddComboToCurrentOrder(args[1], args[2], args[3]);
  } else if (command == Command::PRINT_ALL_SALES) {
    app_.PrintAllSales();
  } else if (command == Command::HELP) {
    cout << Command::GetHelp() << endl;
  } else if (command == Command::EXIT) {
    Message::END.PrintMessage();
    return false;
  } else {
    Message::COMMAND_NOT_FOUND.PrintMessage({cmd_input});
  }
  return true;
}

void Launcher::Start() {
  PrintBanner();
  cout << Command::GetHelp() << endl;

  // Keep reading commands until the user exits
  string cmd_input;
  do {
    cout << COMMAND_PREFIX;
    std::getline(std::cin, cmd_input);
    cmd_input = Utils::TrimString(cmd_input);
  } while (ProcessCommand(cmd_input));
}

void Launcher::PrintBanner() const {
  // https://emojicombos.com/dot-art-generator
  // https://www.freeformatter.com/java-dotnet-escape.html#before-output

  std::string banner =
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2880\u28C0\u2800"
      "\u2800\u2800\u2800\u2800\r\n\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28C0\u28E4"
      "\u28F4\u28FE\u28FF\u28FF\u28FF\u2800\u2800\u2800\u2800\r\n\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u28F4\u28FF\u28FF\u28FF\u28FF\u28FF\u287F\u283F\u280B\u2800\u2800"
      "\u2800\u2800\r\n\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2880\u28FF\u28FF\u28FF\u281F\u2809\u2801"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\r\n\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28B8\u28FF"
      "\u28FF\u287F\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\r\n\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u28F4\u28F6\u28F6\u28F6\u28F6\u28F6"
      "\u28F6\u28F6\u28F6\u28FF\u28FF\u28FF\u28F7\u28F6\u28F6\u28F6\u28F6\u28F6"
      "\u28F6\u28E6\u2800\u2800\u2800\r\n\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u2800\u2800\u2800\r\n\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u2800\u2800\u2800\r\n\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u28C0\u28E4\u28F4\u28F6\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28F6\u28E6\u28E4\u28C0\u2800\u2800\u2809\u2809\u2809"
      "\u2809\u2809\u2809\u2809\u2809\u2809\u2809\u2809\u2809\u2809\u2809\u2809"
      "\u2809\u2809\u2809\u2809\u2801\u2800\u2800\u2800\r\n\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u28E0\u28F4\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28E6\u28C4\u2818\u28BF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u2800\u2800\u2800\u2800"
      "\u2800\r\n\u2800\u2800\u2800\u2800\u2800\u28E0\u28FE\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28F7\u28C4\u2819\u28BF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u2800\u2800\u2800\u2800\u2800\r\n\u2800\u2800\u2800\u2800\u28F4"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28C6\u2808\u28BB\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u2800\u2800\u2800\u2800\u2800\r\n"
      "\u2800\u2800\u2800\u28FC\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u2846\u2800\u28BB"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u2800"
      "\u2800\u2800\u2800\u2800\r\n\u2800\u2800\u28B0\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u2844\u2808\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u2800\u2800\u2800\u2800\u2800\r\n\u2800\u2800"
      "\u2808\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B"
      "\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B"
      "\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u2801\u28A0\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u2800\u2800\u2800"
      "\u2800\u2800\r\n\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2880"
      "\u28F4\u28F6\u28F6\u28F6\u28E6\u2840\u28B0\u28F6\u28F6\u28F6\u28F6\u28F6"
      "\u28F6\u28F6\u2880\u28F4\u28F6\u28F6\u28E6\u28C4\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u2800\u2800\u2800\u2800\u2800\r\n\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u28FF\u28FF\u28FF\u283F\u28FF\u28FF\u28FF\u2878"
      "\u283F\u283F\u28BF\u28FF\u28FF\u28FF\u28A3\u28FF\u28FF\u287F\u28BF\u28FF"
      "\u28FF\u2846\u2800\u2800\u2800\u2800\u2800\u28B9\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u2800\u2800\u2800\u2800\u2800"
      "\r\n\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2809\u2809\u2889"
      "\u28F4\u28FF\u28FF\u287F\u2800\u2800\u2880\u28FE\u28FF\u28FF\u280F\u28B8"
      "\u28FF\u28FF\u2847\u28B8\u28FF\u28FF\u28FF\u2800\u2800\u2800\u2800\u2800"
      "\u28B8\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u2800\u2800\u2800\u2800\u2800\r\n\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u28E0\u28FE\u28FF\u28FF\u28CB\u28C0\u2800\u2880\u28FE"
      "\u28FF\u28FF\u280F\u2800\u28B8\u28FF\u28FF\u28E7\u28F8\u28FF\u28FF\u285F"
      "\u2800\u2800\u2800\u2800\u2800\u28B8\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u2800\u2800\u2800\u2800\u2800\r\n\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2880\u28FC\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u2800\u28FE\u28FF\u28FF\u280F\u2800\u2800\u2800\u283B\u28FF"
      "\u28FF\u28FF\u28FF\u287F\u2801\u2800\u2800\u2800\u2800\u2800\u28B8\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u2800\u2800"
      "\u2800\u2800\u2800\r\n\u2800\u2800\u2800\u2880\u28C0\u28C0\u28C0\u28C0"
      "\u28C9\u28C9\u28C9\u28C9\u28C9\u28C9\u28C1\u28C0\u28C0\u28C0\u28C0\u28C0"
      "\u28C0\u28C0\u28C0\u28C0\u28C8\u28C9\u28C9\u28C1\u28C0\u28C0\u28C0\u28C0"
      "\u28C0\u2840\u2800\u2838\u283F\u283F\u283F\u283F\u283F\u283F\u283F\u283F"
      "\u283F\u283F\u283F\u2801\u2800\u2800\u2800\u2800\r\n\u2800\u2800\u28B8"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u2846\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\r\n\u2800\u2800\u2800\u283B\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF"
      "\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u28FF\u280F"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\r\n\u2800\u2800\u2800\u2800\u2808"
      "\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B"
      "\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B\u281B"
      "\u281B\u281B\u281B\u2801\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\r\n"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\r\n\u2800\u2800\u28F4\u28E6\u28E0\u28F6\u2844"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28A0\u28F6\u2800\u2800"
      "\u2800\u28F6\u28E6\u28E4\u2840\u2800\u2800\u2800\u2800\u2800\u2800\u2800"
      "\u2800\u2800\u2800\u2800\u2800\u2800\u28E0\u2876\u2800\u2800\u2800\u2800"
      "\u2800\u28E4\u2844\u28F4\u2840\u2800\u2800\u2800\u2800\r\n\u2800\u28F8"
      "\u2847\u28B8\u28FF\u2801\u28FF\u2840\u28E0\u28E4\u28E4\u2840\u28C0\u28E4"
      "\u28E4\u28BC\u28C7\u28F4\u2844\u2800\u2847\u2800\u2808\u28BB\u2844\u28C0"
      "\u28E4\u28C4\u2800\u28E6\u28E4\u28C4\u2800\u2880\u28E0\u28E4\u2840\u28FF"
      "\u2847\u2800\u2880\u28E4\u28E4\u28C4\u28FF\u2807\u287E\u2883\u28E4\u28E4"
      "\u28C4\u2840\r\n\u2800\u28FF\u2803\u28B8\u28FF\u2800\u28B9\u2867\u28FF"
      "\u28F6\u28FF\u28B9\u28CF\u2841\u2800\u28B8\u28FF\u2801\u28FF\u2840\u28FF"
      "\u28C0\u28E0\u287F\u28B9\u28CF\u2821\u28F9\u2847\u28FF\u2801\u28B9\u28F7"
      "\u28FF\u2809\u28F8\u28FF\u28B8\u2847\u2800\u2878\u28E7\u2840\u28B9\u28FF"
      "\u2800\u2800\u2818\u28FF\u2836\u28EF\u2840\r\n\u2808\u281B\u2803\u2818"
      "\u281B\u2800\u2818\u2803\u2819\u281B\u281B\u2801\u2819\u281B\u281B\u2818"
      "\u2803\u2800\u2819\u2803\u281B\u281B\u2809\u2800\u2808\u281B\u281B\u280B"
      "\u2800\u281B\u2800\u2818\u2803\u2819\u281B\u280B\u281B\u280A\u281B\u281B"
      "\u2801\u2809\u281B\u281B\u2801\u2800\u2800\u2808\u281B\u281B\u281B"
      "\u2800";
  cout << banner << endl;
}

std::string Launcher::GetCommandPrefix() const { return COMMAND_PREFIX; }
